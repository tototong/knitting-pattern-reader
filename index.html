<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ§¶ ì‹¤ëœ¨ê¸° ë„ì•ˆ ì½ì–´ì£¼ê¸°</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(to bottom, #f3e8ff, #fce7f3); min-height: 100vh; padding: 16px; }
    
    .container { max-width: 1000px; margin: 0 auto; }
    .container.narrow { max-width: 420px; }
    
    h1 { text-align: center; color: #7c3aed; font-size: 24px; margin-bottom: 16px; }
    
    /* 2ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒ */
    .two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items: start;
    }
    .left-panel {
      position: sticky;
      top: 16px;
    }
    .left-panel img {
      width: 100%;
      max-height: calc(100vh - 100px);
      object-fit: contain;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .right-panel {
      max-width: 420px;
    }
    
    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .two-column {
        grid-template-columns: 1fr;
      }
      .left-panel {
        position: relative;
        top: 0;
      }
      .left-panel img {
        max-height: 200px;
        object-fit: contain;
      }
      .right-panel {
        max-width: 100%;
      }
    }
    
    .card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; transition: transform 0.1s; }
    .btn:active { transform: scale(0.95); }
    .btn-purple { background: linear-gradient(to right, #8b5cf6, #ec4899); color: white; }
    .btn-green { background: #22c55e; color: white; }
    .btn-red { background: #ef4444; color: white; }
    .btn-yellow { background: #eab308; color: white; }
    .btn-blue { background: #3b82f6; color: white; }
    .btn-gray { background: #6b7280; color: white; }
    .btn:disabled { background: #d1d5db; cursor: not-allowed; }
    
    .listening-indicator { 
      display: flex; align-items: center; justify-content: center; gap: 8px;
      padding: 12px; background: #fef2f2; border-radius: 12px; margin-bottom: 16px;
    }
    .listening-indicator.active { background: #dcfce7; }
    .pulse-dot {
      width: 12px; height: 12px; background: #ef4444; border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    .listening-indicator.active .pulse-dot { background: #22c55e; }
    @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
    
    .current-display { text-align: center; padding: 24px; }
    .current-display .step { color: #6b7280; font-size: 14px; margin-bottom: 8px; }
    .current-display .main { color: #7c3aed; font-size: 36px; font-weight: bold; margin-bottom: 12px; }
    .current-display .next { color: #9ca3af; font-size: 14px; }
    .transcript { text-align: center; padding: 12px; font-size: 16px; color: #374151; background: #f9fafb; border-radius: 8px; margin-bottom: 16px; min-height: 44px; }
    .commands { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; padding: 12px; background: #faf5ff; border-radius: 12px; margin-bottom: 16px; }
    .commands span { background: white; padding: 8px 4px; border-radius: 8px; text-align: center; font-size: 12px; font-weight: bold; color: #7c3aed; }
    .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px; }
    .controls .btn { padding: 12px; font-size: 16px; }
    
    input[type="text"], input[type="password"] {
      width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px;
      font-size: 14px; margin-bottom: 12px;
    }
    input:focus { outline: none; border-color: #8b5cf6; }
    
    .file-upload {
      position: relative;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      overflow: hidden;
      background: #faf5ff;
      border: 2px dashed #c4b5fd;
      display: block;
    }
    .file-upload:hover {
      background: #f3e8ff;
      border-color: #8b5cf6;
    }
    
    .pattern-list { max-height: 200px; overflow-y: auto; }
    .pattern-item { display: flex; gap: 8px; padding: 4px 0; font-size: 14px; }
    .pattern-item .num { color: #8b5cf6; font-family: monospace; width: 24px; }
    
    .info { background: #eff6ff; border-radius: 12px; padding: 16px; font-size: 14px; color: #1e40af; }
    .info h3 { font-size: 16px; margin-bottom: 8px; }
    .info ol, .info ul { margin-left: 20px; }
    .info li { margin-bottom: 4px; }
    
    .error { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    .success { background: #dcfce7; color: #166534; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    
    .api-section { margin-bottom: 16px; }
    .api-section label { display: block; font-weight: bold; color: #374151; margin-bottom: 8px; }
    
    .loading { display: flex; align-items: center; justify-content: center; gap: 8px; }
    .spinner { width: 20px; height: 20px; border: 3px solid #e5e7eb; border-top-color: #8b5cf6; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .tabs { display: flex; gap: 8px; margin-bottom: 16px; }
    .tab { flex: 1; padding: 12px; text-align: center; border: none; background: #e5e7eb; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .tab.active { background: #8b5cf6; color: white; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // ìƒíƒœ
    let screen = 'setup'; // setup, input, reading
    let apiKey = localStorage.getItem('anthropic_api_key') || '';
    let imageData = null;
    let imagePreview = null;
    let imageType = null;
    let pattern = [];
    let currentIndex = -1;
    let isListening = false;
    let transcript = '';
    let recognition = null;
    let isSpeaking = false;
    let isAnalyzing = false;
    let errorMsg = '';
    let inputMode = 'image'; // image or text
    let manualText = '';
    const synth = window.speechSynthesis;

    // ìŒì„± ì¶œë ¥
    function speak(text) {
      if (!synth) return;
      synth.cancel();
      isSpeaking = true;
      
      if (recognition && isListening) {
        try { recognition.stop(); } catch(e) {}
      }
      
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'ko-KR';
      utterance.rate = 0.8;
      const voices = synth.getVoices();
      const koreanVoice = voices.find(v => v.lang.includes('ko'));
      if (koreanVoice) utterance.voice = koreanVoice;
      
      utterance.onend = () => {
        isSpeaking = false;
        if (screen === 'reading' && isListening) {
          setTimeout(() => startRecognition(), 100);
        }
      };
      
      synth.speak(utterance);
    }

    // ë™ì‘ í•¨ìˆ˜ë“¤
    function goToNext() {
      if (currentIndex < pattern.length - 1) {
        currentIndex++;
        speak(pattern[currentIndex]);
        render();
      } else {
        speak('ë');
      }
    }

    function goToPrev() {
      if (currentIndex > 0) {
        currentIndex--;
        speak(pattern[currentIndex]);
        render();
      }
    }

    function repeatCurrent() {
      if (currentIndex >= 0) speak(pattern[currentIndex]);
    }

    function stopReading() {
      screen = 'input';
      isListening = false;
      currentIndex = -1;
      if (synth) synth.cancel();
      if (recognition) try { recognition.stop(); } catch(e) {}
      render();
    }

    // ìŒì„± ëª…ë ¹ ì²˜ë¦¬
    function processVoiceCommand(text) {
      const cmd = text.toLowerCase().trim();
      
      if (/ë‹¤ìŒ|ë‹¤$|ë‹´|ë‹¨|ë”°ìŒ|ë‹¤ì›€|next|ë„¥ìŠ¤íŠ¸/.test(cmd)) {
        goToNext();
        return 'âœ“ ë‹¤ìŒ';
      }
      if (/ì´ì „|ë’¤ë¡œ|ë’¤|back|ë°±/.test(cmd)) {
        goToPrev();
        return 'âœ“ ì´ì „';
      }
      if (/ë‹¤ì‹œ|ë°˜ë³µ|ë­|again|ì–´ê²Œì¸|ë­ë¼ê³ /.test(cmd)) {
        repeatCurrent();
        return 'âœ“ ë‹¤ì‹œ';
      }
      if (/ì •ì§€|ê·¸ë§Œ|ìŠ¤í†±|stop|ë|ì¢…ë£Œ/.test(cmd)) {
        stopReading();
        return 'âœ“ ì •ì§€';
      }
      return null;
    }

    // ìŒì„± ì¸ì‹ ì‹œì‘
    function startRecognition() {
      if (!recognition || isSpeaking) return;
      try { recognition.start(); } catch (e) {}
    }

    // ìŒì„± ì¸ì‹ ì´ˆê¸°í™”
    function initSpeechRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chromeì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
        return false;
      }

      recognition = new SpeechRecognition();
      recognition.lang = 'ko-KR';
      recognition.continuous = false;
      recognition.interimResults = true;
      recognition.maxAlternatives = 5;

      recognition.onstart = () => {
        transcript = 'ğŸ¤ ë“£ëŠ” ì¤‘...';
        render();
      };

      recognition.onresult = (event) => {
        let finalTranscript = '';
        let interimTranscript = '';

        for (let i = 0; i < event.results.length; i++) {
          const result = event.results[i];
          if (result.isFinal) {
            finalTranscript += result[0].transcript;
          } else {
            interimTranscript += result[0].transcript;
          }
        }

        if (interimTranscript) {
          transcript = `ë“£ëŠ” ì¤‘: "${interimTranscript}"`;
          render();
        }

        if (finalTranscript) {
          const action = processVoiceCommand(finalTranscript);
          transcript = action ? `"${finalTranscript}" â†’ ${action}` : `"${finalTranscript}"`;
          render();
        }
      };

      recognition.onerror = (event) => {
        if (event.error === 'no-speech') {
          transcript = '(ì¡°ìš©í•¨ - ë‹¤ì‹œ ë“£ëŠ” ì¤‘...)';
        } else if (event.error === 'not-allowed') {
          transcript = 'âŒ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”!';
          isListening = false;
        } else if (event.error !== 'aborted') {
          transcript = `ì˜¤ë¥˜: ${event.error}`;
        }
        render();
      };

      recognition.onend = () => {
        if (screen === 'reading' && isListening && !isSpeaking) {
          setTimeout(() => startRecognition(), 50);
        }
      };

      return true;
    }

    // API í‚¤ ì €ì¥
    function saveApiKey() {
      const input = document.getElementById('apiKeyInput');
      if (input && input.value.trim()) {
        apiKey = input.value.trim();
        localStorage.setItem('anthropic_api_key', apiKey);
        screen = 'input';
        render();
      }
    }

    // API í‚¤ ì‚­ì œ
    function clearApiKey() {
      apiKey = '';
      localStorage.removeItem('anthropic_api_key');
      render();
    }

    // ì´ë¯¸ì§€ ì—…ë¡œë“œ
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      errorMsg = '';
      const reader = new FileReader();
      reader.onload = () => {
        imagePreview = reader.result;
        imageData = reader.result.split(',')[1];
        imageType = file.type;
        render();
      };
      reader.readAsDataURL(file);
    }

    // AIë¡œ ë„ì•ˆ ë¶„ì„
    async function analyzePattern() {
      if (!imageData || !apiKey) return;

      isAnalyzing = true;
      errorMsg = '';
      pattern = [];
      render();

      try {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': apiKey,
            'anthropic-version': '2023-06-01',
            'anthropic-dangerous-direct-browser-access': 'true'
          },
          body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: 2000,
            messages: [{
              role: 'user',
              content: [
                { type: 'image', source: { type: 'base64', media_type: imageType, data: imageData } },
                { type: 'text', text: `ì´ê²ƒì€ ëœ¨ê°œì§ˆ/ëŒ€ë°”ëŠ˜/ì½”ë°”ëŠ˜ ë„ì•ˆ ì´ë¯¸ì§€ì…ë‹ˆë‹¤.

ë„ì•ˆì„ ë¶„ì„í•´ì„œ ê° ì½”(ìŠ¤í‹°ì¹˜)ë¥¼ ìˆœì„œëŒ€ë¡œ ì½ì–´ì£¼ì„¸ìš”.

**ë„ì•ˆ ê¸°í˜¸:**
- ë¹ˆì¹¸, |, ì„¸ë¡œì„  = ê²‰ëœ¨ê¸°
- -, ê°€ë¡œì„ , ì  = ì•ˆëœ¨ê¸°
- O, ë™ê·¸ë¼ë¯¸ = ì½”ëŠ˜ë¦¬ê¸°
- /, \\ = ì½”ëª¨ì•„ëœ¨ê¸°
- X = êµì°¨ëœ¨ê¸°

**ì¶œë ¥ ê·œì¹™:**
- ë°˜ë“œì‹œ JSON ë°°ì—´ë¡œë§Œ ì‘ë‹µ
- ì—°ì†ëœ ê°™ì€ ëœ¨ê¸°ëŠ” í•©ì³ì„œ: "ê²‰ëœ¨ê¸° ë‹¤ì„¯ ì½”"
- í–‰ì´ ë°”ë€Œë©´: "ë‹¤ìŒ ì¤„"
- ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ ë°°ì—´ë§Œ

ì˜ˆ: ["ê²‰ëœ¨ê¸° ì„¸ ì½”", "ì•ˆëœ¨ê¸° ë‘ ì½”", "ë‹¤ìŒ ì¤„", "ì•ˆëœ¨ê¸° ë‘ ì½”"]

ë„ì•ˆì„ ì¸ì‹í•  ìˆ˜ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ []` }
              ]
            }]
          })
        });

        if (!response.ok) {
          const err = await response.json();
          throw new Error(err.error?.message || `API ì˜¤ë¥˜: ${response.status}`);
        }

        const data = await response.json();
        
        if (data.content?.[0]?.text) {
          const text = data.content[0].text.trim();
          const jsonMatch = text.match(/\[[\s\S]*\]/);
          
          if (jsonMatch) {
            const parsed = JSON.parse(jsonMatch[0]);
            if (Array.isArray(parsed) && parsed.length > 0) {
              pattern = parsed;
            } else {
              errorMsg = 'ë„ì•ˆì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë” ì„ ëª…í•œ ì´ë¯¸ì§€ë¥¼ ì‹œë„í•´ì£¼ì„¸ìš”.';
            }
          } else {
            errorMsg = 'ë¶„ì„ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          }
        }
      } catch (err) {
        console.error(err);
        errorMsg = `ë¶„ì„ ì‹¤íŒ¨: ${err.message}`;
      } finally {
        isAnalyzing = false;
        render();
      }
    }

    // ìˆ˜ë™ íŒ¨í„´ íŒŒì‹±
    function parseManualPattern() {
      const textarea = document.getElementById('manualInput');
      if (!textarea) return;
      
      const lines = textarea.value.split('\n').map(l => l.trim()).filter(l => l);
      if (lines.length === 0) {
        errorMsg = 'íŒ¨í„´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
        render();
        return;
      }
      
      pattern = lines;
      manualText = textarea.value;
      errorMsg = '';
      render();
    }

    // ì‹œì‘
    function startReading() {
      if (pattern.length === 0) return;
      
      if (!recognition && !initSpeechRecognition()) return;
      
      screen = 'reading';
      isListening = true;
      currentIndex = 0;
      transcript = '';
      speak(pattern[0]);
      render();
    }

    // ë¦¬ì…‹
    function resetAll() {
      stopReading();
      imageData = null;
      imagePreview = null;
      pattern = [];
      manualText = '';
      errorMsg = '';
      screen = 'input';
      render();
    }

    // ë Œë”ë§
    function render() {
      const app = document.getElementById('app');

      // Setup í™”ë©´ (API í‚¤ ì…ë ¥)
      if (screen === 'setup' || !apiKey) {
        app.innerHTML = `
          <div class="container narrow">
            <h1>ğŸ§¶ ì‹¤ëœ¨ê¸° ë„ì•ˆ ì½ì–´ì£¼ê¸°</h1>
            <div class="card">
              <div class="api-section">
                <label>ğŸ”‘ Anthropic API í‚¤</label>
                <input type="password" id="apiKeyInput" placeholder="sk-ant-..." value="${apiKey}" />
                <button onclick="saveApiKey()" class="btn btn-purple">ì €ì¥í•˜ê³  ì‹œì‘</button>
              </div>
            </div>
            
            <div class="info">
              <h3>ğŸ“Œ API í‚¤ ì–»ëŠ” ë°©ë²•</h3>
              <ol>
                <li><a href="https://console.anthropic.com" target="_blank" style="color:#3b82f6">console.anthropic.com</a> ì ‘ì†</li>
                <li>íšŒì›ê°€ì… ë˜ëŠ” ë¡œê·¸ì¸</li>
                <li>API Keys ë©”ë‰´ì—ì„œ ìƒˆ í‚¤ ìƒì„±</li>
                <li>ìœ„ì— ë¶™ì—¬ë„£ê¸°</li>
              </ol>
              <p style="margin-top:12px;font-size:12px;color:#6b7280;">
                * API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
              </p>
            </div>
          </div>
        `;
        return;
      }

      // Reading í™”ë©´ - 2ì»¬ëŸ¼
      if (screen === 'reading') {
        app.innerHTML = `
          <div class="container">
            <h1>ğŸ§¶ ì‹¤ëœ¨ê¸° ë„ì•ˆ ì½ì–´ì£¼ê¸°</h1>
            <div class="two-column">
              <div class="left-panel">
                ${imagePreview ? `<img src="${imagePreview}" alt="ë„ì•ˆ" />` : ''}
              </div>
              <div class="right-panel">
                <div class="listening-indicator ${isListening && !isSpeaking ? 'active' : ''}">
                  <div class="pulse-dot"></div>
                  <span>${isSpeaking ? 'ğŸ”Š ë§í•˜ëŠ” ì¤‘...' : 'ğŸ¤ ë“£ëŠ” ì¤‘ - "ë‹¤ìŒ"ì´ë¼ê³  ë§í•˜ì„¸ìš”'}</span>
                </div>

                <div class="card current-display">
                  <div class="step">${currentIndex + 1} / ${pattern.length}</div>
                  <div class="main">${pattern[currentIndex]}</div>
                  ${currentIndex < pattern.length - 1 ? `<div class="next">ë‹¤ìŒ: ${pattern[currentIndex + 1]}</div>` : ''}
                </div>

                <div class="transcript">${transcript || 'ìŒì„± ì¸ì‹ ëŒ€ê¸° ì¤‘...'}</div>

                <div class="commands">
                  <span>"ë‹¤ìŒ"</span>
                  <span>"ì´ì „"</span>
                  <span>"ë‹¤ì‹œ"</span>
                  <span>"ì •ì§€"</span>
                </div>

                <div class="controls">
                  <button onclick="goToPrev()" class="btn btn-gray" ${currentIndex <= 0 ? 'disabled' : ''}>â¬…ï¸ ì´ì „</button>
                  <button onclick="repeatCurrent()" class="btn btn-yellow">ğŸ”„ ë‹¤ì‹œ</button>
                  <button onclick="goToNext()" class="btn btn-blue" ${currentIndex >= pattern.length - 1 ? 'disabled' : ''}>ë‹¤ìŒ â¡ï¸</button>
                </div>

                <button onclick="stopReading()" class="btn btn-red">â¹ï¸ ì •ì§€</button>
              </div>
            </div>
          </div>
        `;
        return;
      }

      // Input í™”ë©´ - ì´ë¯¸ì§€ ìˆìœ¼ë©´ 2ì»¬ëŸ¼, ì—†ìœ¼ë©´ 1ì»¬ëŸ¼
      if (imagePreview) {
        app.innerHTML = `
          <div class="container">
            <h1>ğŸ§¶ ì‹¤ëœ¨ê¸° ë„ì•ˆ ì½ì–´ì£¼ê¸°</h1>
            <div class="two-column">
              <div class="left-panel">
                <img src="${imagePreview}" alt="ë„ì•ˆ" />
                <label class="file-upload" style="margin-top:12px;display:block;">
                  <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)" style="display:none;" />
                  <span style="color:#6b7280;font-size:14px;">ğŸ“· ë‹¤ë¥¸ ì´ë¯¸ì§€ ì„ íƒ</span>
                </label>
              </div>
              <div class="right-panel">
                ${imageData && pattern.length === 0 ? `
                  <button onclick="analyzePattern()" class="btn btn-purple" ${isAnalyzing ? 'disabled' : ''} style="margin-bottom:16px;">
                    ${isAnalyzing 
                      ? '<span class="loading"><span class="spinner"></span> AIê°€ ë¶„ì„ ì¤‘...</span>'
                      : 'ğŸ” AIë¡œ ë„ì•ˆ ë¶„ì„í•˜ê¸°'}
                  </button>
                ` : ''}

                ${errorMsg ? `<div class="error">${errorMsg}</div>` : ''}

                ${pattern.length > 0 ? `
                  <div class="card">
                    <p style="margin-bottom:12px;font-weight:bold;color:#22c55e;">âœ… ì¸ì‹ëœ íŒ¨í„´ (${pattern.length}ë‹¨ê³„)</p>
                    <div class="pattern-list">
                      ${pattern.map((item, i) => `<div class="pattern-item"><span class="num">${i + 1}.</span><span>${item}</span></div>`).join('')}
                    </div>
                  </div>
                  <button onclick="startReading()" class="btn btn-green" style="font-size:24px;padding:20px;">â–¶ï¸ ì‹œì‘</button>
                ` : ''}

                <div style="display:flex;gap:8px;margin-top:12px;">
                  <button onclick="resetAll()" style="flex:1;padding:12px;background:transparent;border:1px solid #d1d5db;border-radius:8px;color:#6b7280;cursor:pointer;">ğŸ”„ ì²˜ìŒìœ¼ë¡œ</button>
                  <button onclick="clearApiKey()" style="flex:1;padding:12px;background:transparent;border:1px solid #d1d5db;border-radius:8px;color:#6b7280;cursor:pointer;">ğŸ”‘ API í‚¤ ë³€ê²½</button>
                </div>
              </div>
            </div>
          </div>
        `;
      } else {
        // ì´ë¯¸ì§€ ì—†ì„ ë•Œ - 1ì»¬ëŸ¼
        app.innerHTML = `
          <div class="container narrow">
            <h1>ğŸ§¶ ì‹¤ëœ¨ê¸° ë„ì•ˆ ì½ì–´ì£¼ê¸°</h1>
            
            <div class="tabs">
              <button class="tab ${inputMode === 'image' ? 'active' : ''}" onclick="inputMode='image'; render();">ğŸ“· ì´ë¯¸ì§€ ì—…ë¡œë“œ</button>
              <button class="tab ${inputMode === 'text' ? 'active' : ''}" onclick="inputMode='text'; render();">âœï¸ ì§ì ‘ ì…ë ¥</button>
            </div>

            ${inputMode === 'image' ? `
              <label class="file-upload">
                <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)" style="display:none;" />
                <div style="pointer-events:none;">
                  <p style="font-size:48px;margin-bottom:8px;">ğŸ“·</p>
                  <p style="color:#6b7280;">ë„ì•ˆ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•´ì„œ ì—…ë¡œë“œ</p>
                </div>
              </label>
            ` : `
              <div class="card">
                <p style="margin-bottom:12px;font-weight:bold;color:#374151;">íŒ¨í„´ ì…ë ¥ (í•œ ì¤„ì— í•˜ë‚˜ì”©)</p>
                <textarea id="manualInput" style="width:100%;height:150px;padding:12px;border:2px solid #e5e7eb;border-radius:12px;font-size:14px;" placeholder="ê²‰ëœ¨ê¸° ì„¸ ì½”
ì•ˆëœ¨ê¸° ë‘ ì½”
ë‹¤ìŒ ì¤„
ì•ˆëœ¨ê¸° ë‘ ì½”">${manualText}</textarea>
                <button onclick="parseManualPattern()" class="btn btn-purple" style="margin-top:12px;">âœ… íŒ¨í„´ ë“±ë¡</button>
              </div>
            `}

            ${errorMsg ? `<div class="error">${errorMsg}</div>` : ''}

            ${pattern.length > 0 ? `
              <div class="card">
                <p style="margin-bottom:12px;font-weight:bold;color:#22c55e;">âœ… ì¸ì‹ëœ íŒ¨í„´ (${pattern.length}ë‹¨ê³„)</p>
                <div class="pattern-list">
                  ${pattern.map((item, i) => `<div class="pattern-item"><span class="num">${i + 1}.</span><span>${item}</span></div>`).join('')}
                </div>
              </div>
              <button onclick="startReading()" class="btn btn-green" style="font-size:24px;padding:20px;">â–¶ï¸ ì‹œì‘</button>
            ` : ''}

            <div style="display:flex;gap:8px;margin-top:12px;">
              <button onclick="resetAll()" style="flex:1;padding:12px;background:transparent;border:1px solid #d1d5db;border-radius:8px;color:#6b7280;cursor:pointer;">ğŸ”„ ì²˜ìŒìœ¼ë¡œ</button>
              <button onclick="clearApiKey()" style="flex:1;padding:12px;background:transparent;border:1px solid #d1d5db;border-radius:8px;color:#6b7280;cursor:pointer;">ğŸ”‘ API í‚¤ ë³€ê²½</button>
            </div>
          </div>
        `;
      }
    }

    // ì´ˆê¸°í™”
    window.onload = () => {
      synth.getVoices();
      if (apiKey) screen = 'input';
      render();
    };
  </script>
</body>
</html>
